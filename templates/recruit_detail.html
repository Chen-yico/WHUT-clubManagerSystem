{% extends 'base.html' %}
{% block title %}{{ rec.title }} - 招新详情{% endblock %}
{% block content %}
	<div class="card">
		<h2>{{ rec.title }}</h2>
		<p>
			<strong>社团：</strong>{{ rec.club_name }} | 
			<strong>发布时间：</strong>{{ rec.created_at }} | 
			<strong>状态：</strong>{% if rec.is_open %}<span class="tag ok">报名中</span>{% else %}<span class="tag pending">已关闭</span>{% endif %}
			{% if rec.end_time %}
				| <strong>报名截止：</strong>{{ rec.end_time }}
			{% endif %}
		</p>
		<pre style="white-space:pre-wrap; font-family: inherit;">{{ rec.content }}</pre>
		{% if rec.is_open %}
			<h3>我要报名</h3>
			<form method="post" action="{{ url_for('apply_recruitment', rid=rec.id) }}">
				<div class="row">
					<div>
						<label>姓名</label>
						<input class="input" name="name" required />
					</div>
					<div>
						<label>联系方式</label>
						<input class="input" name="contact" required />
					</div>
				</div>
				<div class="row" style="margin-top:12px;">
					<div>
						<label>期望角色</label>
						<input class="input" name="desired_role" placeholder="如：干事、宣传、外联…" />
					</div>
				</div>
				<div style="margin-top:12px;">
					<label>备注</label>
					<textarea class="textarea" name="note" rows="3" placeholder="可选"></textarea>
				</div>
				<div style="margin-top:12px;">
					<button class="button primary" type="submit">提交报名</button>
				</div>
			</form>
		{% else %}
			<p>该公告已关闭报名。</p>
		{% endif %}
	</div>

	{% if g.user and (g.user.is_admin or rec.owner_id == g.user.id) %}
	<div class="card">
		<h3>招新设置</h3>
		<form method="post" action="{{ url_for('recruitment_settings', rid=rec.id) }}">
			<div class="form-group">
				<label>报名结束时间</label>
				<input class="input" name="end_time" type="text" value="{{ rec.end_time or '' }}" placeholder="格式：2025-12-31 或 2025-12-31 23:59" />
				<small style="color: var(--muted);">到达结束时间后，报名将自动关闭。留空表示不限制</small>
			</div>
			<div class="form-actions">
				<button class="button primary" type="submit">保存设置</button>
			</div>
		</form>
	</div>

	<div class="card">
		<h3>近期报名</h3>
		<table class="table">
			<thead>
				<tr><th>姓名</th><th>联系方式</th><th>期望角色</th><th>备注</th><th>状态</th></tr>
			</thead>
			<tbody>
				{% for a in applications %}
				<tr>
					<td>{{ a.applicant_name }}</td>
					<td>{{ a.contact }}</td>
					<td>{{ a.desired_role }}</td>
					<td>{{ a.note }}</td>
					<td>{{ a.status }}</td>
				</tr>
				{% else %}
				<tr><td colspan="5">暂无报名</td></tr>
				{% endfor %}
			</tbody>
		</table>
		<p>
			<a class="button ghost" href="{{ url_for('review_applications', rid=rec.id) }}">进入报名审核</a>
		</p>
	</div>
	{% endif %}
{% endblock %}
