# 高校社团管理系统
# 详细设计说明书

---

**文档版本：** v1.3  
**编写日期：** 2025.11.1年  
**编写人：**   陈澳琪

---

## 目录

1. [文档说明](#1-文档说明)
2. [系统概述](#2-系统概述)
3. [系统总体设计](#3-系统总体设计)
4. [子系统1：用户与社团管理子系统](#4-子系统1用户与社团管理子系统)
5. [子系统2：招新与成员子系统](#5-子系统2招新与成员子系统)
6. [子系统3：活动管理子系统](#6-子系统3活动管理子系统)
7. [子系统4：财务管理子系统](#7-子系统4财务管理子系统)
8. [子系统5：消息与评价子系统](#8-子系统5消息与评价子系统)
9. [数据库设计](#9-数据库设计)
10. [系统架构设计](#10-系统架构设计)
11. [接口设计](#11-接口设计)
12. [用户界面设计](#12-用户界面设计)
13. [安全设计](#13-安全设计)
14. [系统部署与维护](#14-系统部署与维护)

---

## 1. 文档说明

### 1.1 编写目的
本文档旨在详细描述高校社团管理系统的设计实现方案，为系统开发、测试、部署和维护提供技术指导。文档面向系统开发人员、测试人员、系统管理员和相关技术负责人。

### 1.2 文档范围
本文档涵盖了高校社团管理系统的整体架构设计、各子系统的详细设计、数据库设计、接口设计、用户界面设计等内容。

### 1.3 读者对象
- 系统开发人员
- 系统测试人员
- 系统管理员
- 项目管理人员
- 技术支持人员

### 1.4 参考资料
- Flask 官方文档：https://flask.palletsprojects.com/
- SQLite 官方文档：https://www.sqlite.org/docs.html
- RESTful API 设计规范
- Web 安全开发指南

### 1.5 术语定义
- **社团负责人**：创建社团的用户，拥有该社团的管理权限
- **管理员**：系统管理员，拥有审批和全局管理权限
- **普通用户**：注册的学生用户，可以查看和报名社团活动
- **活动审批**：管理员对社团提交的活动策划进行审核批准

---

## 2. 系统概述

### 2.1 系统背景
高校社团管理是校园文化建设的重要组成部分，传统的社团管理方式依赖纸质文档和人工管理，存在效率低下、信息不透明、数据易丢失等问题。为提高社团管理效率，规范社团运营流程，开发本系统。

### 2.2 系统目标
1. **提高管理效率**：通过信息化手段，简化社团管理流程，减少人工操作
2. **规范管理流程**：建立标准化的社团管理流程，包括申请、审批、执行等环节
3. **信息透明化**：提供公开透明的信息发布平台，方便学生了解社团动态
4. **数据化管理**：实现社团数据的电子化管理，便于统计分析和决策支持
5. **提升用户体验**：提供友好的用户界面，简化操作流程，提升用户体验

### 2.3 系统特点
- **模块化设计**：系统采用模块化设计，各子系统相对独立，便于维护和扩展
- **权限分级管理**：实现普通用户、社团负责人、管理员三级权限体系
- **审批流程**：建立完善的审批机制，确保操作规范性
- **实时性**：支持实时信息更新和数据同步
- **易用性**：界面简洁明了，操作便捷

### 2.4 系统运行环境
- **服务器端**：Python 3.8+
- **Web框架**：Flask 3.0+
- **数据库**：SQLite 3
- **客户端**：现代浏览器（Chrome、Edge、Firefox等）

---

## 3. 系统总体设计

### 3.1 系统架构
系统采用B/S（Browser/Server）架构，基于Flask Web框架开发，使用SQLite作为数据存储。

```
┌─────────────────────────────────────────┐
│          客户端浏览器（Browser）          │
│   Chrome / Edge / Firefox / Safari      │
└──────────────────┬──────────────────────┘
                   │ HTTP/HTTPS
                   ▼
┌─────────────────────────────────────────┐
│          Web服务器（Flask）              │
│  ┌──────────┐  ┌──────────┐  ┌────────┐│
│  │路由层    │  │业务逻辑层│  │视图层  ││
│  └──────────┘  └──────────┘  └────────┘│
└──────────────────┬──────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────┐
│        数据访问层（SQLite）              │
│  ┌──────────┐  ┌──────────┐  ┌────────┐│
│  │用户数据  │  │社团数据  │  │业务数据││
│  └──────────┘  └──────────┘  └────────┘│
└─────────────────────────────────────────┘
```

### 3.2 系统功能模块划分
系统共分为5个子系统：

```
高校社团管理系统
├── 子系统1：用户与社团管理子系统
├── 子系统2：招新与成员子系统
├── 子系统3：活动管理子系统
├── 子系统4：财务管理子系统
└── 子系统5：消息与评价子系统
```

### 3.3 系统业务流程
```
用户注册/登录
    ↓
浏览社团/活动
    ↓
创建社团（需审批） → 管理社团 → 发布招新/活动
    ↓
报名参加 → 审核通过 → 成为成员
    ↓
参与活动 → 记录评价
```

---

## 4. 子系统1：用户与社团管理子系统

### 4.1 子系统概述
用户与社团管理子系统是整个系统的基础模块，负责用户身份管理、权限控制和社团基础信息的维护。

### 4.2 功能描述

#### 4.2.1 学生注册登录
**功能说明：**
- 学生用户可以通过用户名和密码注册账号
- 注册时进行用户名唯一性校验
- 密码使用Werkzeug进行哈希加密存储
- 登录时验证用户名和密码
- 支持会话管理，登录后保持登录状态

**输入：**
- 用户名（必填，唯一）
- 密码（必填，长度>=6）

**输出：**
- 注册成功/失败提示
- 登录成功/失败提示

**处理流程：**
```
1. 用户输入注册信息
2. 系统验证用户名是否已存在
3. 系统对密码进行哈希加密
4. 系统保存用户信息到数据库
5. 返回注册结果

1. 用户输入登录信息
2. 系统查询用户是否存在
3. 系统验证密码是否正确
4. 创建用户会话（Session）
5. 跳转到系统首页
```

#### 4.2.2 社团创建申请
**功能说明：**
- 已登录用户可以申请创建社团
- 提交社团名称和简介
- 社团名称需要唯一性校验
- 创建申请需要管理员审批
- 申请状态：待审批（pending）/已批准（approved）

**输入：**
- 社团名称（必填，唯一）
- 社团简介（可选）

**输出：**
- 申请提交成功提示
- 审批状态显示

**处理流程：**
```
1. 用户填写社团创建申请
2. 系统验证社团名称是否已存在
3. 系统保存申请记录（状态：pending）
4. 管理员在后台审批申请
5. 审批通过后，社团状态变为approved
6. 申请创建者自动成为社团负责人
```

#### 4.2.3 社团信息维护
**功能说明：**
- 社团负责人可以编辑社团基本信息
- 管理员可以编辑所有社团信息
- 支持修改社团名称和简介
- 社团名称修改时需要重新验证唯一性

**输入：**
- 社团名称（必填，唯一）
- 社团简介（可选）

**输出：**
- 更新成功/失败提示

**处理流程：**
```
1. 社团负责人/管理员进入编辑页面
2. 系统验证用户权限
3. 用户修改社团信息
4. 系统验证新名称唯一性（如修改名称）
5. 系统更新数据库记录
6. 返回更新结果
```

### 4.3 数据库设计

#### 4.3.1 用户表（users）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 用户ID（自增） |
| username | TEXT | NOT NULL UNIQUE | 用户名（唯一） |
| password_hash | TEXT | NOT NULL | 密码哈希值 |
| is_admin | INTEGER | NOT NULL DEFAULT 0 | 是否管理员（0否，1是） |

#### 4.3.2 社团表（clubs）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 社团ID（自增） |
| name | TEXT | NOT NULL UNIQUE | 社团名称（唯一） |
| description | TEXT | DEFAULT '' | 社团简介 |
| owner_id | INTEGER | | 负责人用户ID（外键→users.id） |
| status | TEXT | NOT NULL DEFAULT 'pending' | 状态（pending/approved） |
| available_amount | REAL | NOT NULL DEFAULT 0 | 可用经费额度 |

### 4.4 接口设计

#### 4.4.1 用户注册接口
```
POST /register
请求参数：
- username: string（必填）
- password: string（必填）
响应：JSON
{
  "success": true/false,
  "message": "提示信息"
}
```

#### 4.4.2 用户登录接口
```
POST /login
请求参数：
- username: string（必填）
- password: string（必填）
- next: string（可选，登录后跳转URL）
响应：重定向或JSON
```

#### 4.4.3 社团创建接口
```
POST /clubs
请求参数：
- name: string（必填）
- description: string（可选）
响应：JSON或重定向
```

#### 4.4.4 社团编辑接口
```
GET /clubs/<club_id>/edit     # 获取编辑表单
POST /clubs/<club_id>/edit    # 提交编辑
请求参数：
- name: string（必填）
- description: string（可选）
响应：JSON或重定向
```

### 4.5 界面设计
- **注册页面**：包含用户名、密码输入框和注册按钮
- **登录页面**：包含用户名、密码输入框和登录按钮，支持"记住我"功能
- **社团列表页**：以表格形式展示所有社团，支持搜索和筛选
- **社团详情页**：显示社团基本信息和管理操作入口
- **社团创建/编辑页**：表单页面，包含社团名称、简介等字段

---

## 5. 子系统2：招新与成员子系统

### 5.1 子系统概述
招新与成员子系统负责社团的成员招募、报名审核和成员档案管理，是社团日常运营的核心模块。

### 5.2 功能描述

#### 5.2.1 社团招新发布
**功能说明：**
- 社团负责人可以发布招新公告
- 招新公告包含标题、内容、报名截止时间
- 支持标记重要招新（置顶显示）
- 招新状态：开放报名（is_open=1）/已关闭（is_open=0）
- 到达截止时间后自动关闭报名

**输入：**
- 招新标题（必填）
- 招新内容（可选）
- 报名截止时间（可选，格式：YYYY-MM-DD HH:MM）

**输出：**
- 招新公告列表
- 招新详情页面

**处理流程：**
```
1. 社团负责人进入发布招新页面
2. 系统验证用户权限（需是社团负责人）
3. 用户填写招新信息
4. 系统保存招新公告
5. 系统自动检查是否到达截止时间
6. 到达截止时间后自动关闭报名
```

#### 5.2.2 成员报名审核
**功能说明：**
- 学生可以浏览开放的招新公告
- 学生可以提交报名申请，填写姓名、联系方式、期望角色等信息
- 社团负责人和管理员可以审核报名申请
- 审核状态：待审核（pending）/已通过（approved）/已拒绝（rejected）
- 审核通过后自动添加为社团成员
- 支持批量审核操作

**输入：**
- 报名信息：姓名（必填）、联系方式（必填）、期望角色（可选）、备注（可选）

**输出：**
- 报名成功提示
- 报名审核列表
- 审核结果提示

**处理流程：**
```
1. 学生浏览招新公告
2. 学生填写报名信息并提交
3. 系统保存报名记录（状态：pending）
4. 社团负责人查看报名列表
5. 社团负责人审核报名申请
6. 审核通过：自动添加为社团成员
7. 审核拒绝：记录拒绝原因
8. 系统通知申请人审核结果
```

#### 5.2.3 社团成员档案管理
**功能说明：**
- 显示社团所有成员列表
- 社团负责人可以添加成员（手动添加）
- 支持编辑成员信息（姓名、角色）
- 支持删除成员
- 显示成员角色（如：社长、副社长、干事、成员等）
- 统计成员总数

**输入：**
- 成员姓名（必填）
- 成员角色（可选，默认：成员）

**输出：**
- 成员列表
- 成员统计信息

**处理流程：**
```
1. 社团负责人进入成员管理页面
2. 系统显示当前所有成员列表
3. 社团负责人可以：
   - 添加新成员（输入姓名和角色）
   - 编辑成员信息（修改姓名或角色）
   - 删除成员
4. 系统更新数据库
5. 更新成员列表显示
```

### 5.3 数据库设计

#### 5.3.1 招新公告表（recruitments）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 招新ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| title | TEXT | NOT NULL | 招新标题 |
| content | TEXT | DEFAULT '' | 招新内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 发布时间 |
| is_open | INTEGER | NOT NULL DEFAULT 1 | 是否开放报名（0关闭，1开放） |
| end_time | TEXT | DEFAULT '' | 报名截止时间 |

#### 5.3.2 报名申请表（applications）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 申请ID（自增） |
| recruitment_id | INTEGER | NOT NULL | 招新ID（外键→recruitments.id） |
| applicant_name | TEXT | NOT NULL | 申请人姓名 |
| contact | TEXT | NOT NULL | 联系方式 |
| desired_role | TEXT | DEFAULT '成员' | 期望角色 |
| note | TEXT | DEFAULT '' | 备注信息 |
| status | TEXT | NOT NULL DEFAULT 'pending' | 审核状态（pending/approved/rejected） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 申请时间 |

#### 5.3.3 成员表（members）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 成员ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| name | TEXT | NOT NULL | 成员姓名 |
| role | TEXT | DEFAULT '成员' | 成员角色 |

### 5.4 接口设计

#### 5.4.1 发布招新接口
```
POST /recruit
请求参数：
- club_id: integer（必填）
- title: string（必填）
- content: string（可选）
- end_time: string（可选）
响应：重定向或JSON
```

#### 5.4.2 报名申请接口
```
POST /recruit/<rid>/apply
请求参数：
- name: string（必填）
- contact: string（必填）
- desired_role: string（可选）
- note: string（可选）
响应：重定向或JSON
```

#### 5.4.3 报名审核接口
```
GET /recruit/<rid>/review          # 查看审核列表
POST /applications/<app_id>/approve    # 审核通过
POST /applications/<app_id>/reject     # 审核拒绝
响应：重定向或JSON
```

#### 5.4.4 成员管理接口
```
GET /clubs/<club_id>/members           # 成员列表
GET /clubs/<club_id>/members/new        # 添加成员表单
POST /clubs/<club_id>/members           # 添加成员
GET /members/<member_id>/edit            # 编辑成员表单
POST /members/<member_id>/edit          # 更新成员
POST /members/<member_id>/delete        # 删除成员
响应：HTML或JSON
```

### 5.5 界面设计
- **招新公告列表页**：显示所有开放的招新公告，支持筛选和搜索
- **招新详情页**：显示招新详细信息，包含报名表单（如开放）
- **报名审核页**：以表格形式展示报名申请，支持批量审核
- **成员管理页**：显示成员列表，提供添加、编辑、删除操作

---

## 6. 子系统3：活动管理子系统

### 6.1 子系统概述
活动管理子系统负责社团活动的策划、审批、报名和物资管理，是社团开展活动的核心平台。

### 6.2 功能描述

#### 6.2.1 活动策划提交（审批）
**功能说明：**
- 社团负责人可以提交活动策划
- 活动策划包含：活动标题、活动内容、开始时间、地点等信息
- 活动需要管理员审批后才能发布
- 审批状态：待审批（pending）/已批准（approved）
- 活动可以设置报名容量限制和报名截止时间

**输入：**
- 活动标题（必填）
- 活动内容（可选）
- 开始时间（可选）
- 地点（可选）
- 报名容量（可选，0表示不限制）
- 报名截止时间（可选）

**输出：**
- 活动列表
- 活动详情页面
- 审批结果提示

**处理流程：**
```
1. 社团负责人填写活动策划
2. 系统保存活动记录（状态：pending）
3. 管理员查看待审批活动列表
4. 管理员审批活动
5. 审批通过后，活动状态变为approved
6. 活动对外显示，学生可以报名
```

#### 6.2.2 活动报名
**功能说明：**
- 学生可以浏览已审批通过的活动
- 学生可以报名参加活动
- 报名时需要填写姓名、联系方式、备注信息
- 系统检查活动是否开放报名、是否已满员、是否超过截止时间
- 显示报名人数和剩余名额
- 活动负责人可以手动关闭/开启报名

**输入：**
- 姓名（必填）
- 联系方式（必填）
- 备注（可选）

**输出：**
- 报名成功/失败提示
- 报名人数统计
- 报名列表

**处理流程：**
```
1. 学生浏览活动详情
2. 系统检查活动状态（是否审批通过、是否开放报名）
3. 系统检查是否满员
4. 系统检查是否超过报名截止时间
5. 学生填写报名信息
6. 系统保存报名记录
7. 更新报名人数统计
```

#### 6.2.3 活动物资申请
**功能说明：**
- 活动负责人可以为活动申请所需物资
- 物资申请包含：物资名称、数量、备注信息
- 物资申请需要管理员审批
- 审批状态：待审批（pending）/已批准（approved）/已拒绝（rejected）
- 活动负责人可以查看物资申请状态

**输入：**
- 物资名称（必填）
- 数量（必填，>=1）
- 备注（可选）

**输出：**
- 物资申请列表
- 审批结果提示

**处理流程：**
```
1. 活动负责人进入物资申请页面
2. 选择关联的活动
3. 填写物资申请信息
4. 系统保存申请记录（状态：pending）
5. 管理员查看物资申请列表
6. 管理员审批申请
7. 系统更新申请状态
8. 活动负责人查看审批结果
```

### 6.3 数据库设计

#### 6.3.1 活动表（events）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 活动ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| title | TEXT | NOT NULL | 活动标题 |
| content | TEXT | DEFAULT '' | 活动内容 |
| start_time | TEXT | DEFAULT '' | 开始时间 |
| location | TEXT | DEFAULT '' | 活动地点 |
| status | TEXT | NOT NULL DEFAULT 'pending' | 审批状态（pending/approved） |
| capacity | INTEGER | NOT NULL DEFAULT 0 | 报名容量（0表示不限制） |
| deadline | TEXT | DEFAULT '' | 报名截止时间 |
| is_open | INTEGER | NOT NULL DEFAULT 1 | 是否开放报名（0关闭，1开放） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 6.3.2 活动报名表（event_signups）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 报名ID（自增） |
| event_id | INTEGER | NOT NULL | 活动ID（外键→events.id） |
| name | TEXT | NOT NULL | 报名人姓名 |
| contact | TEXT | NOT NULL | 联系方式 |
| note | TEXT | DEFAULT '' | 备注信息 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 报名时间 |

#### 6.3.3 物资申请表（material_requests）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 申请ID（自增） |
| event_id | INTEGER | NOT NULL | 活动ID（外键→events.id） |
| item_name | TEXT | NOT NULL | 物资名称 |
| quantity | INTEGER | NOT NULL DEFAULT 1 | 数量 |
| note | TEXT | DEFAULT '' | 备注信息 |
| status | TEXT | NOT NULL DEFAULT 'pending' | 审批状态（pending/approved/rejected） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 申请时间 |

### 6.4 接口设计

#### 6.4.1 活动创建接口
```
POST /events
请求参数：
- club_id: integer（必填）
- title: string（必填）
- content: string（可选）
- start_time: string（可选）
- location: string（可选）
- capacity: integer（可选）
- deadline: string（可选）
响应：重定向或JSON
```

#### 6.4.2 活动审批接口
```
POST /events/<event_id>/approve
响应：重定向或JSON
```

#### 6.4.3 活动报名接口
```
POST /events/<event_id>/signup
请求参数：
- name: string（必填）
- contact: string（必填）
- note: string（可选）
响应：重定向或JSON
```

#### 6.4.4 物资申请接口
```
POST /events/<event_id>/materials
请求参数：
- item_name: string（必填）
- quantity: integer（必填）
- note: string（可选）
响应：重定向或JSON
```

#### 6.4.5 物资审批接口
```
POST /materials/<req_id>/approve     # 审批通过
POST /materials/<req_id>/reject      # 审批拒绝
响应：重定向或JSON
```

### 6.5 界面设计
- **活动列表页**：显示所有已审批通过的活动，支持筛选和搜索
- **活动详情页**：显示活动详细信息，包含报名表单和报名人数统计
- **活动审批页**：管理员查看待审批活动列表，支持批量审批
- **物资申请页**：活动负责人提交物资申请表单
- **物资审核页**：管理员查看和审批物资申请

---

## 7. 子系统4：财务管理子系统

### 7.1 子系统概述
财务管理子系统负责社团经费的申请、审批、支出记录和财务报表生成，实现社团经费的规范化管理。

### 7.2 功能描述

#### 7.2.1 社团经费申请
**功能说明：**
- 社团负责人可以向管理员申请经费
- 经费申请包含：申请标题、申请金额、申请理由等信息
- 经费申请需要管理员审批
- 审批状态：待审批（pending）/已批准（approved）/已拒绝（rejected）
- 审批通过后，经费额度自动增加到社团可用余额中

**输入：**
- 申请标题（必填）
- 申请金额（必填，>0）
- 申请理由（可选）

**输出：**
- 经费申请列表
- 审批结果提示
- 可用额度更新

**处理流程：**
```
1. 社团负责人填写经费申请
2. 系统保存申请记录（状态：pending）
3. 管理员查看经费申请列表
4. 管理员审批申请
5. 审批通过：增加社团可用额度
6. 审批拒绝：记录拒绝原因
7. 更新申请状态
```

#### 7.2.2 经费支出记录
**功能说明：**
- 社团负责人可以记录经费支出
- 支出记录包含：支出标题、支出金额、支出日期、备注信息
- 系统检查可用额度是否充足
- 支出金额自动从可用额度中扣除
- 支持记录历史支出，便于追溯

**输入：**
- 支出标题（必填）
- 支出金额（必填，>0）
- 支出日期（可选）
- 备注（可选）

**输出：**
- 支出记录列表
- 可用额度更新

**处理流程：**
```
1. 社团负责人填写支出信息
2. 系统检查可用额度是否充足
3. 如果额度不足，提示错误
4. 如果额度充足，保存支出记录
5. 自动扣除可用额度
6. 更新财务总览
```

#### 7.2.3 财务报表生成
**功能说明：**
- 支持按日期范围筛选财务数据
- 显示指定时间段内的审批经费总额
- 显示指定时间段内的支出总额
- 计算剩余可用额度
- 显示详细的支出明细列表
- 支持导出财务报表（可选功能）

**输入：**
- 开始日期（可选）
- 结束日期（可选）

**输出：**
- 财务报表页面
- 财务汇总信息
- 支出明细列表

**处理流程：**
```
1. 用户选择日期范围（可选）
2. 系统查询指定时间段内的审批经费
3. 系统查询指定时间段内的支出记录
4. 系统计算剩余额度（审批总额 - 支出总额）
5. 系统显示财务报表
6. 如果设置了结束日期，显示截止到该日期的实际余额
```

### 7.3 数据库设计

#### 7.3.1 经费申请表（finance_requests）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 申请ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| title | TEXT | NOT NULL | 申请标题 |
| amount | REAL | NOT NULL | 申请金额 |
| reason | TEXT | DEFAULT '' | 申请理由 |
| status | TEXT | NOT NULL DEFAULT 'pending' | 审批状态（pending/approved/rejected） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 申请时间 |

#### 7.3.2 支出记录表（expenses）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 支出ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| title | TEXT | NOT NULL | 支出标题 |
| amount | REAL | NOT NULL | 支出金额 |
| note | TEXT | DEFAULT '' | 备注信息 |
| spent_at | TEXT | DEFAULT '' | 支出日期 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 记录时间 |

### 7.4 接口设计

#### 7.4.1 经费申请接口
```
POST /finance/<club_id>/request
请求参数：
- title: string（必填）
- amount: float（必填）
- reason: string（可选）
响应：重定向或JSON
```

#### 7.4.2 经费审批接口
```
GET /finance/review                    # 查看待审批申请
POST /finance/request/<req_id>/approve  # 审批通过
POST /finance/request/<req_id>/reject   # 审批拒绝
响应：重定向或JSON
```

#### 7.4.3 支出记录接口
```
POST /finance/<club_id>/expenses
请求参数：
- title: string（必填）
- amount: float（必填）
- spent_at: string（可选）
- note: string（可选）
响应：重定向或JSON
```

#### 7.4.4 财务报表接口
```
GET /finance/<club_id>/report
请求参数：
- start: string（可选，开始日期）
- end: string（可选，结束日期）
响应：HTML页面
```

### 7.5 界面设计
- **财务总览页**：显示可用额度、申请记录、支出记录概览
- **经费申请页**：社团负责人提交经费申请表单
- **经费审批页**：管理员查看和审批经费申请
- **支出记录页**：记录和查看支出信息
- **财务报表页**：显示财务汇总和明细，支持日期筛选

---

## 8. 子系统5：消息与评价子系统

### 8.1 子系统概述
消息与评价子系统负责社团通知推送、活动满意度评价和社团星级评定，促进社团与学生之间的互动交流。

### 8.2 功能描述

#### 8.2.1 社团通知推送
**功能说明：**
- 社团负责人可以发布社团通知消息
- 通知消息包含：标题、内容等信息
- 支持标记重要消息，重要消息置顶显示
- 所有用户都可以浏览所有社团的消息
- 支持按社团筛选消息
- 社团负责人可以删除自己社团的消息

**输入：**
- 消息标题（必填）
- 消息内容（可选）
- 是否重要（可选，复选框）

**输出：**
- 消息列表页面
- 消息详情页面

**处理流程：**
```
1. 社团负责人进入发布消息页面
2. 系统验证用户权限
3. 用户填写消息内容
4. 用户可选择标记为重要消息
5. 系统保存消息记录
6. 消息显示在消息列表中（重要消息置顶）
7. 用户可以在首页和消息列表页查看消息
```

#### 8.2.2 活动满意度评价
**功能说明：**
- 活动结束后，用户可以对该活动进行评价
- 评价包含：星级评分（1-5星）、评价内容（可选）
- 系统统计活动的平均评分和评价数量
- 显示活动评分统计信息（如：4.5分，共10条评价）

**输入：**
- 星级评分（必填，1-5之间的整数）
- 评价内容（可选）

**输出：**
- 活动平均评分
- 评价数量统计
- 评价成功提示

**处理流程：**
```
1. 用户浏览活动详情
2. 用户进入评价页面或表单
3. 用户选择星级（1-5星）
4. 用户填写评价内容（可选）
5. 系统保存评价记录
6. 系统重新计算活动平均评分
7. 更新活动评分显示
```

#### 8.2.3 社团星级评定
**功能说明：**
- 社团成员可以对自己所在的社团进行评价
- 评价包含：星级评分（1-5星）、评价内容（可选）
- 系统统计社团的平均评分和评价数量
- 非成员用户无法评价社团
- 显示社团评分统计信息

**输入：**
- 星级评分（必填，1-5之间的整数）
- 评价内容（可选）

**输出：**
- 社团平均评分
- 评价数量统计
- 评价成功提示

**处理流程：**
```
1. 社团成员进入社团详情页
2. 系统验证用户是否为该社团成员
3. 用户选择星级（1-5星）
4. 用户填写评价内容（可选）
5. 系统保存评价记录
6. 系统重新计算社团平均评分
7. 更新社团评分显示
```

### 8.3 数据库设计

#### 8.3.1 消息表（messages）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 消息ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| title | TEXT | NOT NULL | 消息标题 |
| content | TEXT | DEFAULT '' | 消息内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 发布时间 |
| is_important | INTEGER | NOT NULL DEFAULT 0 | 是否重要（0否，1是） |

#### 8.3.2 活动评价表（event_ratings）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 评价ID（自增） |
| event_id | INTEGER | NOT NULL | 活动ID（外键→events.id） |
| rating | INTEGER | NOT NULL | 评分（1-5） |
| note | TEXT | DEFAULT '' | 评价内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 评价时间 |

#### 8.3.3 社团评价表（club_ratings）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 评价ID（自增） |
| club_id | INTEGER | NOT NULL | 社团ID（外键→clubs.id） |
| member_name | TEXT | NOT NULL | 评价人姓名（与用户名对应） |
| rating | INTEGER | NOT NULL | 评分（1-5） |
| note | TEXT | DEFAULT '' | 评价内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 评价时间 |

### 8.4 接口设计

#### 8.4.1 消息发布接口
```
POST /clubs/<club_id>/messages
请求参数：
- title: string（必填）
- content: string（可选）
- is_important: boolean（可选）
响应：重定向或JSON
```

#### 8.4.2 活动评价接口
```
POST /events/<event_id>/rate
请求参数：
- rating: integer（必填，1-5）
- note: string（可选）
响应：重定向或JSON
```

#### 8.4.3 社团评价接口
```
POST /clubs/<club_id>/rate
请求参数：
- rating: integer（必填，1-5）
- note: string（可选）
响应：重定向或JSON
```

### 8.5 界面设计
- **消息列表页**：显示所有社团消息，重要消息置顶，支持按社团筛选
- **消息详情页**：显示消息完整内容
- **活动详情页**：包含评价表单和评分统计显示
- **社团详情页**：包含评价表单和评分统计显示（仅成员可见）

---

## 9. 数据库设计

### 9.1 数据库概述
系统使用SQLite作为数据库，SQLite是一个轻量级的嵌入式数据库，适合中小型应用。数据库文件存储在`instance/clubmgr.db`。

### 9.2 数据库表关系图

```
┌──────────┐
│  users   │
└────┬─────┘
     │ owner_id
     │
┌────▼─────┐
│  clubs   │
└────┬─────┘
     │
     ├──────┬──────────┬──────────┬──────────┬──────────┐
     │      │          │          │          │          │
┌────▼───┐ ┌▼────────┐ ┌▼────────┐ ┌▼────────┐ ┌▼────────┐
│members │ │recruit- │ │ events  │ │finance_ │ │messages │
│        │ │ ments   │ │         │ │requests │ │         │
└────┬───┘ └────┬────┘ └────┬────┘ └────┬────┘ └──────────┘
     │          │           │           │
     │    ┌─────▼──┐   ┌────▼────┐  ┌───▼────┐
     │    │applica-│   │event_   │  │expenses│
     │    │ tions  │   │signups  │  │        │
     │    └────────┘   └─────────┘  └────────┘
     │                      │
     │                  ┌───▼─────────┐
     │                  │material_    │
     │                  │requests     │
     │                  └─────────────┘
     │                      │
     └──────────────────┬───┴──────────┐
                        │              │
                   ┌────▼────┐   ┌────▼────┐
                   │event_   │   │club_    │
                   │ratings  │   │ratings  │
                   └─────────┘   └─────────┘
```

### 9.3 完整数据表清单

1. **users** - 用户表
2. **clubs** - 社团表
3. **members** - 成员表
4. **recruitments** - 招新公告表
5. **applications** - 报名申请表
6. **events** - 活动表
7. **event_signups** - 活动报名表
8. **material_requests** - 物资申请表
9. **finance_requests** - 经费申请表
10. **expenses** - 支出记录表
11. **messages** - 消息表
12. **event_ratings** - 活动评价表
13. **club_ratings** - 社团评价表

### 9.4 数据库索引设计
- `users.username`: UNIQUE索引（保证用户名唯一）
- `clubs.name`: UNIQUE索引（保证社团名称唯一）
- `clubs.owner_id`: 索引（加速查询社团负责人）
- `members.club_id`: 索引（加速查询社团成员）
- `events.club_id`: 索引（加速查询社团活动）
- `finance_requests.club_id`: 索引（加速查询社团财务）

### 9.5 数据完整性约束
- 外键约束：确保关联数据的一致性
- 级联删除：删除社团时，自动删除相关数据
- 非空约束：保证关键字段不为空
- 唯一性约束：保证用户名、社团名称的唯一性

---

## 10. 系统架构设计

### 10.1 技术架构
```
┌─────────────────────────────────────────┐
│          表现层（Presentation）          │
│  HTML + CSS + JavaScript + Jinja2      │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│         业务逻辑层（Business Logic）      │
│  Flask Routes + View Functions           │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│         数据访问层（Data Access）         │
│  SQLite Database + ORM                   │
└─────────────────────────────────────────┘
```

### 10.2 分层设计

#### 10.2.1 表现层
- **HTML模板**：使用Jinja2模板引擎渲染页面
- **CSS样式**：统一的样式文件，保证界面一致性
- **JavaScript**：前端交互和验证（可选）

#### 10.2.2 业务逻辑层
- **路由处理**：定义URL路由和HTTP方法
- **请求处理**：处理用户请求，验证权限
- **业务逻辑**：实现各种业务功能
- **数据验证**：验证输入数据的合法性

#### 10.2.3 数据访问层
- **数据库连接**：管理数据库连接
- **SQL执行**：执行数据库查询和更新
- **数据迁移**：处理数据库结构变更

### 10.3 模块划分

```
app.py
├── 配置模块
│   ├── Flask应用初始化
│   ├── 数据库配置
│   └── 密钥配置
├── 工具函数模块
│   ├── 数据库连接管理
│   ├── 权限验证函数
│   └── 辅助函数
├── 路由模块
│   ├── 用户认证路由
│   ├── 社团管理路由
│   ├── 招新管理路由
│   ├── 活动管理路由
│   ├── 财务管理路由
│   └── 消息评价路由
└── 数据库初始化模块
    ├── 表结构创建
    ├── 数据迁移
    └── 初始数据导入
```

---

## 11. 接口设计

### 11.1 接口设计原则
- **RESTful风格**：遵循REST设计规范
- **统一响应格式**：使用统一的响应结构
- **错误处理**：完善的错误处理机制
- **权限验证**：所有接口进行权限验证

### 11.2 接口分类

#### 11.2.1 认证接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /register | POST | 用户注册 |
| /login | POST | 用户登录 |
| /logout | POST | 用户退出 |

#### 11.2.2 社团管理接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /clubs | GET | 获取社团列表 |
| /clubs | POST | 创建社团申请 |
| /clubs/<id>/edit | GET/POST | 编辑社团 |
| /clubs/<id>/delete | POST | 删除社团 |
| /clubs/<id>/approve | POST | 审批社团 |

#### 11.2.3 招新管理接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /recruit | POST | 发布招新 |
| /recruit/<id> | GET | 招新详情 |
| /recruit/<id>/apply | POST | 报名申请 |
| /recruit/<id>/settings | POST | 设置截止时间 |

#### 11.2.4 活动管理接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /events | POST | 创建活动 |
| /events/<id> | GET | 活动详情 |
| /events/<id>/signup | POST | 活动报名 |
| /events/<id>/approve | POST | 审批活动 |
| /events/<event_id>/materials | POST | 申请物资 |

#### 11.2.5 财务管理接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /finance/<club_id> | GET | 财务总览 |
| /finance/<club_id>/request | POST | 经费申请 |
| /finance/<club_id>/expenses | POST | 记录支出 |
| /finance/<club_id>/report | GET | 财务报表 |

#### 11.2.6 消息评价接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /messages | GET | 消息列表 |
| /clubs/<club_id>/messages | POST | 发布消息 |
| /events/<id>/rate | POST | 评价活动 |
| /clubs/<id>/rate | POST | 评价社团 |

### 11.3 接口响应格式

#### 成功响应
```json
{
  "success": true,
  "message": "操作成功",
  "data": {}
}
```

#### 错误响应
```json
{
  "success": false,
  "message": "错误信息",
  "error_code": "ERROR_CODE"
}
```

---

## 12. 用户界面设计

### 12.1 设计原则
- **简洁明了**：界面简洁，信息清晰
- **一致性**：统一的视觉风格和交互方式
- **易用性**：操作简单，符合用户习惯
- **响应式**：适配不同屏幕尺寸

### 12.2 页面布局
```
┌─────────────────────────────────────┐
│         导航栏（Navbar）              │
├─────────────────────────────────────┤
│                                     │
│         主要内容区域                 │
│                                     │
│    ┌─────────┬─────────┐          │
│    │ 左侧内容 │ 右侧内容 │          │
│    └─────────┴─────────┘          │
│                                     │
├─────────────────────────────────────┤
│         页脚（Footer）              │
└─────────────────────────────────────┘
```

### 12.3 主要页面设计

#### 12.3.1 首页
- 欢迎横幅
- 近期活动列表
- 最新招新公告
- 社团消息
- 待审批活动（管理员可见）

#### 12.3.2 登录/注册页
- 简洁的表单设计
- 清晰的错误提示
- 友好的引导信息

#### 12.3.3 社团列表页
- 表格展示社团信息
- 支持筛选和搜索
- 快速操作按钮

#### 12.3.4 详情页面
- 清晰的标题和元信息
- 主要内容区域
- 操作按钮区域
- 相关列表展示

### 12.4 色彩方案
- **主色调**：金色（#f59e0b）- 代表活力和热情
- **背景色**：暖白色（#fff7ed）- 温和舒适
- **强调色**：绿色（成功）、红色（错误/重要）
- **文字色**：深灰色（#1f2937）

### 12.5 交互设计
- **按钮样式**：主要按钮（primary）、次要按钮（ghost）、危险按钮（danger）
- **标签样式**：状态标签（已通过/待审批）、重要标签（重要消息）
- **表格交互**：悬停高亮、排序功能（可选）
- **表单验证**：实时验证、友好提示

---

## 13. 安全设计

### 13.1 身份认证
- **密码加密**：使用Werkzeug的密码哈希算法，不存储明文密码
- **会话管理**：使用Flask Session管理用户登录状态
- **密钥配置**：使用安全的SECRET_KEY

### 13.2 权限控制
- **三级权限体系**：
  - 普通用户：浏览、报名
  - 社团负责人：管理本社团
  - 管理员：全局管理权限
- **权限验证**：所有需要权限的操作都进行验证

### 13.3 数据安全
- **SQL注入防护**：使用参数化查询
- **XSS防护**：模板自动转义
- **CSRF防护**：敏感操作使用POST方法
- **输入验证**：对所有用户输入进行验证和过滤

### 13.4 操作审计
- **关键操作记录**：记录重要操作的创建时间
- **数据追踪**：通过created_at字段追踪数据创建时间

### 13.5 安全建议
- 生产环境使用HTTPS
- 定期备份数据库
- 使用强密码策略
- 定期更新依赖包
- 设置防火墙规则

---

## 14. 系统部署与维护

### 14.1 部署环境要求
- **操作系统**：Windows 10+/Linux/macOS
- **Python版本**：3.8或更高
- **数据库**：SQLite 3（内置）
- **Web服务器**：Flask开发服务器（开发环境）

### 14.2 部署步骤

#### 14.2.1 开发环境部署
1. 安装Python 3.8+
2. 安装依赖：`pip install -r requirements.txt`
3. 运行系统：`python app.py`
4. 访问系统：http://127.0.0.1:5000

#### 14.2.2 生产环境部署
1. 使用Gunicorn作为WSGI服务器
2. 使用Nginx作为反向代理
3. 配置HTTPS证书
4. 设置数据库备份策略

### 14.3 系统维护

#### 14.3.1 日常维护
- 定期备份数据库
- 监控系统运行状态
- 查看错误日志
- 更新依赖包

#### 14.3.2 数据备份
```bash
# 备份数据库
cp instance/clubmgr.db instance/clubmgr.db.backup

# 或使用SQLite备份命令
sqlite3 instance/clubmgr.db ".backup 'backup.db'"
```

#### 14.3.3 性能优化
- 数据库索引优化
- 查询语句优化
- 静态资源缓存
- 减少数据库查询次数

### 14.4 故障处理
- **数据库损坏**：使用备份文件恢复
- **端口占用**：修改端口配置
- **权限错误**：检查文件权限设置
- **依赖问题**：重新安装依赖包

### 14.5 系统扩展
- 支持多数据库（MySQL/PostgreSQL）
- 支持文件上传功能
- 支持邮件通知
- 支持短信通知
- 移动端适配

---

## 附录

### 附录A：变更日志
- v1.0：初始版本
- v1.1：添加消息推送功能
- v1.2：添加招新截止时间功能
- v1.3：修复财务报表筛选问题

---

